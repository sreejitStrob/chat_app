<!DOCTYPE html>
<html>
  <head>
    
    <title>Pusher Test</title>
    
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <link rel="stylesheet" href="style.css">

    <script src="https://js.pusher.com/5.0/pusher.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    
    <script>
      // Enable pusher logging - don't include this in production
      Pusher.logToConsole = true;

      var pusher = new Pusher('7455a3c52b935d083656', {
        cluster: 'ap2',
        forceTLS: true
      });

      var channel = pusher.subscribe('my-channel');
      channel.bind('my-event', function(data) {
        chat_display(data);
      });
    </script>

  </head>
  <body>
    <div class="panel panel-primary">
      <div class="panel-heading">
          <span class="glyphicon glyphicon-comment"></span> Chat
      </div>
      <div class="panel-body">
          <ul class="chat" id='chat'></ul>
      </div>
      <div class="panel-footer">
          <div class="input-group">
              <input id="btn-input" type="text" class="form-control input-sm" placeholder="Type your message here..." />
              <span class="input-group-btn">
                  <button class="btn btn-warning btn-sm" id="btn-chat"><i class="glyphicon glyphicon-send"></i></button>
              </span>
          </div>
      </div>
    </div>  
    
   
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>

    <script>
     
      $("#btn-chat").click(function() {
        sendMessage();
      });

      $('#btn-input').on('keypress',function(e) {
          if(e.which == 13) {
            sendMessage();
          }
      });

      function sendMessage() {
        let message = $('#btn-input').val();
        if(message != '') {
<<<<<<< HEAD
          $.post( "chat.php", { message: message, name: 'vishal', color: '000'}).done(function() {
=======
          $.post( "chat.php", { message: message, name: 'sreejit', color: 'c9043'}).done(function() {
          console.log(message);
>>>>>>> c5f3ae8ffe436fab1394fa5a8a41688d2837e4ff
          $('#btn-input').val("");
        });
        }
      }

      function chat_display(context) {

        let data = JSON.parse(context);
        console.log(data);

        $('#chat').append(`
          <li class="left clearfix">
              <span class="chat-img pull-left">
                <img src="http://placehold.it/50/${data.color}/fff&text=${(data.name).charAt(0)}" alt="User Avatar" class="img-circle" />
              </span>
              <div class="chat-body clearfix">
                  <div class="header">
                    <strong class="primary-font">${data.name}</strong> 
                  </div>
                  <p>${data.message}</p>
              </div>
            </li>
        `);
        notifyMe(context);
      }





      function notifyMe(context) {

  if (!("Notification" in window)) {
    alert("This browser does not support desktop notification");
  }

  else if (Notification.permission === "granted") {
    var notification = new Notification(context);
  }

  else if (Notification.permission !== "denied") {
    Notification.requestPermission().then(function (permission) {
      if (permission === "granted") {
        var notification = new Notification(context);
      }
    });
  }
}
    </script>
    
  </body>
</html>